
    <%- include("../../views/partials/user/header") %>

    
    <style>
       * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        .product-Details-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 10px;
            padding-top: 50px;
        }
        .page-header {
         margin-bottom: 10px;
         background-color: #f1f1f1;

        .breadcrumb {
            margin-bottom: 0rem; 
        }
       }
        .breadcrumb-wrap {
            background-color: #e9ecef;
            padding: 15px 0;
            background-color: #f1f1f1;

        }

        .breadcrumb a {
            color: #1b1b1c;
            text-decoration: none;
        }

        .breadcrumb span {
            margin: 0 5px;
            color: #6c757d;
        }

        .product-detail {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-top: 30px;
        }

        .product-gallery {
            position: relative;
        }

        .main-image {
            overflow: hidden;
            cursor: zoom-in;
            position: relative;
            width: 100%;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .main-image img {
            width: 100%;
            height: auto;
            border-radius: 10px;
            transition: transform 0.1s ease-out;
            will-change: transform;
            display: block;
        }

        .zoom-icon {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .thumbnail-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .thumbnail {
            width: 100%;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .thumbnail.active {
            border-color: #008080;
        }

        .thumbnail img {
            width: 100%;
            height: auto;
            border-radius: 8px;
        }

        .product-info h1 {
            font-size: 28px;
            margin-bottom: 15px;
        }

        .rating {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .stars {
            color: #ffc107;
        }

        .review-count {
            color: #666;
            font-size: 14px;
        }

        .price-section {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .sale-price {
            font-size: 24px;
            font-weight: bold;
            color: #008080;
        }

        .regular-price {
            text-decoration: line-through;
            color: #666;
        }

        .discount {
            color: #28a745;
        }

        .description {
            color: #666;
            margin-bottom: 20px;
        }

        .features {
            margin-bottom: 30px;
        }

        .feature-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .quantity-section {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .quantity-input {
            display: flex;
            align-items: center;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .quantity-btn {
            padding: 10px 15px;
            background: none;
            border: none;
            cursor: pointer;
        }

        .quantity-value {
            padding: 10px 20px;
            border-left: 1px solid #ddd;
            border-right: 1px solid #ddd;
        }

        .add-to-cart {
            padding: 12px 30px;
            background-color: #008080;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .wishlist-btn {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: none;
            cursor: pointer;
        }

        .product-meta {
            font-size: 14px;
            color: #666;
        }

        .product-meta p {
            margin-bottom: 8px;
        }

        .stock {
            color: #28a745;
        }

        .reviews-section {
            margin-top: 60px;
            padding-top: 40px;
            border-top: 1px solid #eee;
        }

        .reviews-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .reviews-title {
            font-size: 24px;
            font-weight: bold;
        }

        .write-review-btn {
            padding: 10px 20px;
            background-color: #008080;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .review-form {
            display: none;
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #eee;
            border-radius: 10px;
        }

        .review-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .form-group textarea {
            height: 120px;
            resize: vertical;
        }

        .star-rating {
            display: flex;
            gap: 5px;
            font-size: 24px;
            color: #ddd;
            cursor: pointer;
        }

        .star-rating .star:hover,
        .star-rating .star.active {
            color: #ffc107;
        }

        .image-upload {
            margin-top: 10px;
        }

        .submit-review-btn {
            padding: 12px 30px;
            background-color: #008080;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .review-card {
            padding: 20px;
            border: 1px solid #eee;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .reviewer-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .reviewer-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #008080;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .reviewer-name {
            font-weight: bold;
        }

        .review-date {
            color: #666;
            font-size: 14px;
        }

        .review-rating {
            color: #ffc107;
            margin-bottom: 10px;
        }

        .review-text {
            color: #444;
            line-height: 1.6;
        }

        .review-images {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .review-image {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            object-fit: cover;
        }

        .helpful-btn {
            padding: 5px 15px;
            background: none;
            border: 1px solid #ddd;
            border-radius: 15px;
            color: #666;
            cursor: pointer;
            margin-top: 10px;
        }

        .helpful-btn:hover {
            background-color: #f5f5f5;
        }

        /* Size Selection Styles */
        .size-selection {
            margin-bottom: 30px;
        }

        .size-label {
            display: block;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .size-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .size-btn {
            padding: 10px 20px;
            border: 2px solid #ddd;
            border-radius: 5px;
            background: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .size-btn:hover:not(.disabled) {
            border-color: #008080;
            color: #008080;
        }

        .size-btn.active {
            background-color: #008080;
            color: white;
            border-color: #008080;
        }

        .size-btn.disabled {
            cursor: not-allowed;
            opacity: 0.5;
            background-color: #f5f5f5;
        }

        .selected-size-stock {
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }

        /* Related Products Styles */
        .related-products {
            margin-top: 60px;
            padding-top: 40px;
            border-top: 1px solid #eee;
        }

        .related-products h2 {
            font-size: 24px;
            margin-bottom: 30px;
        }

        .related-products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 30px;
        }

        .related-product-item {
            border: 1px solid #eee;
            border-radius: 10px;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .related-product-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .related-product-item a {
            text-decoration: none;
            color: inherit;
        }

        .product-image {
            position: relative;
            padding-top: 100%;
            overflow: hidden;
        }

        .product-image img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .related-product-item:hover .product-image img {
            transform: scale(1.05);
        }

        .product-info {
            padding: 15px;
        }

        .product-info h3 {
            font-size: 16px;
            margin-bottom: 10px;
            color: #333;
        }

        .product-price {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .price {
            font-size: 18px;
            font-weight: bold;
            color: #008080;
        }

        .regular-price {
            font-size: 14px;
            color: #666;
            text-decoration: line-through;
        }

        .view-details-btn {
            width: 100%;
            padding: 12px;
            background-color: #008080;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .view-details-btn:hover {
            background-color: #006666;
        }
        .notification {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
    max-width: 350px;
    animation: slideIn 0.5s ease-out;
}

.notification-content {
    background-color: #fff;
    color: #333;
    padding: 15px 20px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
}

.notification.success .notification-content {
    background-color: #4CAF50;
    color: white;
}

.notification.error .notification-content {
    background-color: #f44336;
    color: white;
}

.close-notification {
    background: none;
    border: none;
    color: inherit;
    font-size: 20px;
    cursor: pointer;
    padding: 0;
    line-height: 1;
}

@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes slideOut {
    from {
        transform: translateX(0);
        opacity: 1;
    }
    to {
        transform: translateX(100%);
        opacity: 0;
    }
}

        @media (max-width: 768px) {
            .product-detail {
                grid-template-columns: 1fr;
            }

            .main-image {
                cursor: default;
            }

            .main-image img {
                transform: none !important;
            }

            .related-products-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .related-products-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>

    <div class="product-Details-container">
        <div class="page-header breadcrumb-wrap">
            <div class="container">
                <div class="breadcrumb">
                    <a href="/" rel="nofollow">Home</a>
                    <span><a href="/shop" rel="nofollow">Shop</a></span> 
                    <span><a href="/" rel="nofollow">productDetails</a></span> 
                </div>
            </div>
        </div>


        <div class="product-detail">
            <div class="product-gallery">
                <div class="main-image">
                    <img src="/uploads/product-images/<%=product.productImage[0]%>" alt="product-image">
                </div>
                <div class="thumbnail-grid">
                    <%for(let i=0;i<product.productImage.length;i++){%>
                        <div class="thumbnail">
                            <img src="/uploads/product-images/<%=product.productImage[i]%>" alt="Thumbnail 1">
                        </div>
                        <%}%>
                </div>
            </div>

            <div class="product-info">
                <h1>
                    <%=product.productName%>
                </h1>
                <!-- <div class="rating">
                    <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</div>
                    <span class="review-count">(25 reviews)</span>
                </div> -->

                <div class="price-section">
                    <span class="sale-price">‚Çπ<%=product.salePrice%></span>
                    <span class="regular-price">‚Çπ<%=product.regularPrice%></span>
                    <span class="discount">
                        <%=totalOffer%>% Offer
                    </span>
                </div>

                <p class="description">
                    <%=product.description%>
                </p>

                <div class="features">
                    <div class="feature-item">
                        <span>üëë</span>
                        <span>1 Year Brand Warranty</span>
                    </div>
                    <div class="feature-item">
                        <span>üîÑ</span>
                        <span>30 Day Return Policy</span>
                    </div>
                    <div class="feature-item">
                        <span>üí≥</span>
                        <span>Cash on Delivery available</span>
                    </div>
                </div>

                <div class="size-selection">
                    <label class="size-label">Select Size</label>
                    <div class="size-options">
                        <% product.sizeVariants.forEach(variant=> { %>
                            <button class="size-btn <%= variant.quantity === 0 ? 'disabled' : '' %>"
                                data-size="<%= variant.size %>" data-quantity="<%= variant.quantity %>"
                                <%=variant.quantity===0 ? 'disabled' : '' %>>
                                <%= variant.size %>
                            </button>
                            <% }); %>
                    </div>
                    <p class="selected-size-stock"></p>
                </div>

                <div class="quantity-section">
                    <div class="quantity-input">
                        <button class="quantity-btn" onclick="decrementQuantity()">-</button>
                        <span class="quantity-value">1</span>
                        <button class="quantity-btn" onclick="incrementQuantity()">+</button>
                    </div>
                    <div class="action-buttons">
                        <button class="add-to-cart" onclick="addToCart()">
                            <i class="fas fa-shopping-cart"></i> Add to Cart
                        </button>
                    </div>
                </div>


                <div class="product-meta">
                    <p>Stock Code: FWM15VKT</p>
                    <p>Tags: <%=category.name%>
                    </p>
                    <p>Availability:</p>
                    <% if (totalQuantity> 0) { %>
                        <ul class="stock">
                            <% product.sizeVariants.forEach(variant=> { %>
                                <li>Size: <%= variant.size %> - <%= variant.quantity %> Items in Stock</li>
                                <% }); %>
                        </ul>
                        <% } else { %>
                            <p class="out-of-stock">Out of Stock</p>
                            <% } %>
                </div>
            </div>
        </div>
        <div id="notification" class="notification" style="display: none;">
            <div class="notification-content">
                <span id="notification-message"></span>
                <button class="close-notification">√ó</button>
            </div>
        </div>
        <!-- Review Section -->
        <div class="reviews-section">
            <div class="reviews-header">
                <h2 class="reviews-title">Customer Reviews</h2>
                <button class="write-review-btn" onclick="toggleReviewForm()">Write a Review</button>
            </div>

            <!-- Review Form -->
            <div class="review-form" id="reviewForm">
                <form onsubmit="submitReview(event)">
                    <div class="form-group">
                        <!-- <label>Rating</label>
                        <div class="star-rating" id="ratingStars">
                            <span class="star" data-rating="1">‚òÖ</span>
                            <span class="star" data-rating="2">‚òÖ</span>
                            <span class="star" data-rating="3">‚òÖ</span>
                            <span class="star" data-rating="4">‚òÖ</span>
                            <span class="star" data-rating="5">‚òÖ</span>
                        </div> -->
                    </div>
                    <div class="form-group">
                        <label>Review Title</label>
                        <input type="text" required placeholder="Sum up your review in a short title">
                    </div>
                    <div class="form-group">
                        <label>Your Review</label>
                        <textarea required
                            placeholder="Write your review here. What did you like or dislike? What did you use this product for?"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Add Photos (optional)</label>
                        <input type="file" accept="image/*" multiple class="image-upload">
                    </div>
                    <button type="submit" class="submit-review-btn">Submit Review</button>
                </form>
            </div>

            <!-- Review List -->
            <div class="review-list">
                <div class="review-card">
                    <div class="review-header">
                        <div class="reviewer-info">
                            <div class="reviewer-avatar">J</div>
                            <div>
                                <div class="reviewer-name">John Doe</div>
                                <div class="review-date">January 10, 2024</div>
                            </div>
                        </div>
                        <!-- <div class="review-rating">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div> -->
                    </div>
                    <div class="review-text">
                        Great product! The quality is exceptional and it arrived exactly as described.
                        Very happy with my purchase and would definitely recommend it to others.
                    </div>
                    <!-- <button class="helpful-btn">üëç Helpful (12)</button> -->
                </div>

                <div class="review-card">
                    <div class="review-header">
                        <div class="reviewer-info">
                            <div class="reviewer-avatar">S</div>
                            <div>
                                <div class="reviewer-name">Sarah Smith</div>
                                <div class="review-date">January 8, 2024</div>
                            </div>
                        </div>
                        <!-- <div class="review-rating">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</div> -->
                    </div>
                    <div class="review-text">
                        Very satisfied with the product. Shipping was fast and the item meets all my expectations.
                        The only minor issue was with the packaging, but the product itself is perfect.
                    </div>
                    <div class="review-images">
                        <img src="/api/placeholder/80/80" alt="Review image" class="review-image">
                        <img src="/api/placeholder/80/80" alt="Review image" class="review-image">
                    </div>
                    <!-- <button class="helpful-btn">üëç Helpful (8)</button> -->
                </div>
            </div>
            <div class="related-products">
                <h2>Related Products</h2>
                <% if (relatedProduct && relatedProduct.length> 0) { %>
                    <div class="related-products-grid">
                        <% relatedProduct.forEach(product=> { %>
                            <div class="related-product-item">
                                <a href="/productDetails/<%= product._id %>">
                                    <div class="product-image">
                                        <img src="/uploads/product-images/<%= product.productImage[0] %>"
                                            alt="<%= product.productName %>">
                                    </div>
                                    <div class="product-info">
                                        <h3>
                                            <%= product.productName %>
                                        </h3>
                                        <div class="product-price">
                                            <span class="price">‚Çπ<%= product.salePrice %></span>
                                            <% if (product.regularPrice> product.salePrice) { %>
                                                <span class="regular-price">‚Çπ<%= product.regularPrice %></span>
                                                <% } %>
                                        </div>
                                    </div>
                                </a>
                                <!-- View Details Button -->
                                <a href="/productDetails/<%= product._id %>">
                                    <button class="view-details-btn">View Details</button>
                                </a>
                            </div>
                            <% }) %>
                    </div>
                    <%}else{%>
                        <p>No related products found</p>
                        <% } %>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const mainImage = document.querySelector('.main-image img');
            const thumbnails = document.querySelectorAll('.thumbnail img');

            thumbnails.forEach(thumbnail => {
                thumbnail.addEventListener('click', function () {
                    mainImage.src = this.src;

                    thumbnails.forEach(thumb => {
                        thumb.parentElement.classList.remove('active');
                    });

                    this.parentElement.classList.add('active');
                });
            });

            const mainImageContainer = document.querySelector('.main-image');

            function zoomImage(e) {
                const rect = mainImage.getBoundingClientRect();
                const x = ((e.clientX - rect.left) / rect.width) * 100;
                const y = ((e.clientY - rect.top) / rect.height) * 100;

                mainImage.style.transform = 'scale(2)';
                mainImage.style.transformOrigin = `${x}% ${y}%`;
            }

            function resetImage() {
                mainImage.style.transform = 'scale(1)';
            }

            mainImageContainer.addEventListener('mousemove', zoomImage);
            mainImageContainer.addEventListener('mouseleave', resetImage);
            mainImageContainer.addEventListener('mouseenter', function () {
                mainImage.style.transition = 'transform 0.1s ease-out';
            });
        });
        document.addEventListener('DOMContentLoaded', function () {
            const sizeButtons = document.querySelectorAll('.size-btn');
            const stockDisplay = document.querySelector('.selected-size-stock');
            const addToCartBtn = document.querySelector('.add-to-cart');
            let selectedSize = null;

            sizeButtons.forEach(button => {
                button.addEventListener('click', function () {
                    if (this.classList.contains('disabled')) return;

                    sizeButtons.forEach(btn => btn.classList.remove('active'));

                    this.classList.add('active');

                    selectedSize = this.dataset.size;
                    const quantity = this.dataset.quantity;
                    stockDisplay.textContent = `Size ${selectedSize}: ${quantity} items in stock`;

                    addToCartBtn.disabled = false;
                });
            });

            let quantity = 1;
            const quantityValue = document.querySelector('.quantity-value');

            window.incrementQuantity = function () {
                const activeButton = document.querySelector('.size-btn.active');
                if (!activeButton) return;

                const maxStock = parseInt(activeButton.dataset.quantity);
                if (quantity < maxStock) {
                    quantity++;
                    quantityValue.textContent = quantity;
                }
            }

            window.decrementQuantity = function () {
                if (quantity > 1) {
                    quantity--;
                    quantityValue.textContent = quantity;
                }
            }

            window.addToCart = function () {
                if (!selectedSize) {
                    showNotification('Please select a size first');
                    return;
                }

                console.log("selected size",selectedSize)

                const productId = window.location.pathname.split('/').pop();
                const data = {
                    productId: productId,
                    size: selectedSize,
                    quantity: quantity
                };

                console.log(data)

                fetch('/addToCart', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            showNotification('Product added to cart successfully!');
                        } else {
                            showNotification(data.message || 'Error adding product to cart');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error.message);
                        showNotification('Error adding product to cart');
                    });
            }

            function showNotification(message, type = 'success') {
    const notification = document.getElementById('notification');
    const messageElement = document.getElementById('notification-message');
    
    messageElement.textContent = message;
    notification.className = `notification ${type}`;
    notification.style.display = 'block';

    const timeout = setTimeout(() => {
        hideNotification();
    }, 3000);

    document.querySelector('.close-notification').onclick = () => {
        clearTimeout(timeout);
        hideNotification();
    };
}

function hideNotification() {
    const notification = document.getElementById('notification');
    notification.style.animation = 'slideOut 0.5s ease-out';
    setTimeout(() => {
        notification.style.display = 'none';
        notification.style.animation = 'slideIn 0.5s ease-out';
    }, 500);
}

        });
    </script>